# Minishell

Простейший Unix shell на языке Go

## Возможности

- ✅ Выполнение встроенных команд (`cd`, `pwd`, `echo`, `kill`, `ps`)
- ✅ Выполнение внешних команд из системного PATH
- ✅ Поддержка конвейеров команд (pipes)
- ✅ Условное выполнение команд (`&&`, `||`)
- ✅ Редиректы ввода/вывода (`>`, `>>`, `<`, `2>`)
- ✅ Подстановка переменных окружения (`$VAR`)
- ✅ Поддержка кавычек** (одинарные и двойные)
- ✅ Обработка сигналов (SIGINT, SIGTERM)
- ✅ Интерактивный режим работы
- ✅ Обработка ошибок и их вывод в stderr
- ✅ Модульная архитектура с внедрением зависимостей

## Структура проекта

```
lvl2/l15/
├── cmd/
│   └── main.go              # Точка входа в приложение
├── internal/
│   ├── shell/               # Основной модуль shell
│   │   ├── shell.go         # Основная логика shell
│   │   └── shell_test.go    # Юнит-тесты
│   ├── parser/              # Парсинг команд
│   │   ├── parser.go        # Разбор команд, конвейеров, условных операторов
│   │   └── parser_test.go   # Тесты парсера
│   ├── executor/            # Выполнение команд
│   │   └── executor.go      # Координация выполнения с редиректами
│   ├── commands/            # Обработчики команд
│   │   ├── builtin.go       # Встроенные команды
│   │   └── external.go      # Внешние команды
│   └── io/                  # Ввод-вывод
│       ├── reader.go        # Чтение из stdin
│       └── writer.go        # Запись в stdout/stderr
├── demo.sh                  # Базовый демонстрационный скрипт
├── demo_advanced.sh         # Демонстрация расширенных возможностей
├── minishell               # Исполняемый файл
├── go.mod                  # Зависимости Go
└── go.sum                  # Хеши зависимостей
```

## Компоненты

### Shell (`internal/shell/`)
Основной модуль, координирующий работу всех компонентов:
- Управляет жизненным циклом приложения
- Обрабатывает сигналы завершения
- Координирует взаимодействие между reader, executor и writer

### Parser (`internal/parser/`)
Расширенный парсер команд:
- Парсит строки команд в структуры данных
- Поддерживает конвейеры команд (разделение по `|`)
- **Обрабатывает условные операторы** (`&&`, `||`)
- **Поддерживает редиректы** (`>`, `>>`, `<`, `2>`)
- **Подставляет переменные окружения** (`$VAR`)
- **Сохраняет кавычки** в аргументах
- Извлекает имя команды и аргументы

### Executor (`internal/executor/`)
Координирует выполнение команд:
- Выбирает подходящий обработчик для команды
- Управляет выполнением конвейеров
- **Обрабатывает условное выполнение** (логика `&&` и `||`)
- **Настраивает редиректы** ввода/вывода
- Обрабатывает ошибки выполнения

### Commands (`internal/commands/`)
Обработчики команд:
- **Builtin**: встроенные команды (`cd`, `pwd`, `echo`, `kill`, `ps`)
- **External**: внешние команды из системного PATH

### IO (`internal/io/`)
Модуль ввода-вывода:
- **Reader**: чтение команд из stdin
- **Writer**: вывод результатов и ошибок

## Встроенные команды

| Команда | Описание |
|---------|----------|
| `cd [path]` | Смена директории (без аргументов - переход в домашнюю) |
| `pwd` | Вывод текущей рабочей директории |
| `echo [args...]` | Вывод аргументов в stdout |
| `kill {pid}` | Отправка сигнала SIGTERM процессу |
| `ps` | Вывод списка процессов |

## Установка и запуск

### Требования
- Go 1.21 или выше

### Сборка
```bash
cd lvl2/l15
go build -o minishell cmd/main.go
```

### Запуск
```bash
./minishell
```

### Демонстрация

Для быстрого ознакомления со всеми возможностями программы запустите демо-скрипт:


```bash
chmod +x demo.sh
./demo.sh
```

## Тестирование

Проект включает юнит-тесты с покрытием 91.7%:

```bash
# Запуск всех тестов
go test ./... -v

# Запуск тестов парсера
go test ./internal/parser/... -v

# Запуск тестов конкретного модуля
go test ./internal/shell/... -v
```

## Особенности реализации

### Обработка ошибок
- Все ошибки логируются в stderr
- Graceful shutdown при получении сигналов
- Продолжение работы при ошибках в командах

## Ограничения

- Конвейеры выполняются последовательно (без параллельного выполнения)
- Ограниченный набор встроенных команд
- Нет поддержки арифметических выражений
- Нет поддержки функций и алиасов

## Разработка

### Добавление новой встроенной команды

1. Добавить обработчик в `internal/commands/builtin.go`:
```go
func (h *BuiltinCommandHandler) newCommand(ctx context.Context, args []string) error {
// Реализация команды
return nil
}
```

2. Зарегистрировать команду в конструкторе:
```go
handler.handlers["newcommand"] = handler.newCommand
```

### Расширение парсера

Модифицировать `internal/parser/parser.go` для поддержки новых синтаксических конструкций.

### Добавление новых типов редиректов

1. Добавить новый тип в `parser.RedirectType`
2. Обновить `isRedirect()` и `parseRedirect()`
3. Добавить обработку в `executor.setupRedirects()`
